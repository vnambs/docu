"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7928],{5460:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var r=i(4848),t=i(8453);const s={},o="Nginx Proxying",a={id:"Strapi/Production basis/NGINX-Proxy",title:"Nginx Proxying",description:'As Strapi does not handle SSL directly and hosting a Node.js service on the "edge" network is not a secure solution it is recommended that you use some sort of proxy application such as Nginx, Apache, HAProxy, Traefik, or others. The following documentation provides some sample configurations for Nginx, naturally these configs may not suit all environments and you will likely need to adjust them to fit your needs.',source:"@site/docs/Strapi/Production basis/NGINX-Proxy.md",sourceDirName:"Strapi/Production basis",slug:"/Strapi/Production basis/NGINX-Proxy",permalink:"/docu/docs/Strapi/Production basis/NGINX-Proxy",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Strapi/Production basis/NGINX-Proxy.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Certbot",permalink:"/docu/docs/Strapi/Production basis/Certbot"},next:{title:"NGINX and Strapi",permalink:"/docu/docs/Strapi/Production basis/NGINX"}},d={},l=[{value:"Configuration\u200b",id:"configuration",level:2},{value:"Strapi server\u200b",id:"strapi-server",level:3},{value:"Subdomain Strapi configuration\u200b",id:"subdomain-strapi-configuration",level:4},{value:"Subfolder unified Strapi configuration\u200b",id:"subfolder-unified-strapi-configuration",level:4},{value:"Nginx Upstream\u200b",id:"nginx-upstream",level:3},{value:"Nginx Virtual Host\u200b",id:"nginx-virtual-host",level:3},{value:"Subdomain\u200b",id:"subdomain",level:4},{value:"Subfolder unified\u200b",id:"subfolder-unified",level:4},{value:"Redirecting landing page to admin panel\u200b",id:"redirecting-landing-page-to-admin-panel",level:3},{value:"Redirecting landing page to admin panel\u200b",id:"redirecting-landing-page-to-admin-panel-1",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"nginx-proxying",children:"Nginx Proxying"}),"\n",(0,r.jsx)(n.p,{children:'As Strapi does not handle SSL directly and hosting a Node.js service on the "edge" network is not a secure solution it is recommended that you use some sort of proxy application such as Nginx, Apache, HAProxy, Traefik, or others. The following documentation provides some sample configurations for Nginx, naturally these configs may not suit all environments and you will likely need to adjust them to fit your needs.'}),"\n",(0,r.jsxs)(n.h2,{id:"configuration",children:["Configuration",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#configuration",title:"Direct link to Configuration",children:"\u200b"})]}),"\n",(0,r.jsx)(n.p,{children:"The following configuration is based on Nginx virtual hosts, this means that you create configurations for each domain to allow serving multiple domains on the same port such as 80 (HTTP) or 443 (HTTPS). It also uses a central upstream file to store an alias to allow for easier management, load balancing, and failover in the case of clustering multiple Strapi deployments."}),"\n",(0,r.jsxs)(n.h3,{id:"strapi-server",children:["Strapi server",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#strapi-server",title:"Direct link to Strapi server",children:"\u200b"})]}),"\n",(0,r.jsxs)(n.p,{children:["In order to take full advantage of a proxied Strapi application, Strapi should be configured so it's aware of the upstream proxy. Like with the below configurations there are 3 matching examples. Additional information can be found in the\xa0",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/configurations/server",children:"server configuration"}),"\xa0and\xa0",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/configurations/admin-panel",children:"admin configuration"}),"\xa0documentations."]}),"\n",(0,r.jsx)(n.p,{children:"\u270f\ufe0f\xa0Note"}),"\n",(0,r.jsxs)(n.p,{children:["These examples use the default API Prefix of\xa0",(0,r.jsx)(n.code,{children:"/api"}),". This can be changed without the need to directly modify the Nginx configuration (see the\xa0",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/configurations/api",children:"API prefix"}),"\xa0documentation)."]}),"\n",(0,r.jsx)(n.p,{children:"\u270b\xa0Caution"}),"\n",(0,r.jsxs)(n.p,{children:["If the\xa0",(0,r.jsx)(n.code,{children:"url"}),"\xa0key is changed in the\xa0",(0,r.jsx)(n.code,{children:"./config/admin.js"}),"\xa0or\xa0",(0,r.jsx)(n.code,{children:"./config/server.js"}),"\xa0files, the admin panel needs to be rebuilt with\xa0",(0,r.jsx)(n.code,{children:"yarn build"}),"\xa0or\xa0",(0,r.jsx)(n.code,{children:"npm run build"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Subdomain"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"subdomain-strapi-configuration",children:["Subdomain Strapi configuration",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#subdomain-strapi-configuration",title:"Direct link to Subdomain Strapi configuration",children:"\u200b"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example domain:\xa0",(0,r.jsx)(n.code,{children:"api.example.com"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example admin:\xa0",(0,r.jsx)(n.code,{children:"api.example.com/admin"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example API:\xa0",(0,r.jsx)(n.code,{children:"api.example.com/api"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example uploaded files (local provider):\xa0",(0,r.jsx)(n.code,{children:"api.example.com/uploads"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"JavaScript"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"TypeScript"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"path: ./config/server.ts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export default ({ env }) => ({\r\n  host: env('HOST', '0.0.0.0'),\r\n  port: env.int('PORT', 1337),\r\n  url: 'https://api.example.com',\r\n});\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Subfolder unified"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"subfolder-unified-strapi-configuration",children:["Subfolder unified Strapi configuration",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#subfolder-unified-strapi-configuration",title:"Direct link to Subfolder unified Strapi configuration",children:"\u200b"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example domain:\xa0",(0,r.jsx)(n.code,{children:"example.com/test"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example admin:\xa0",(0,r.jsx)(n.code,{children:"example.com/test/admin"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example API:\xa0",(0,r.jsx)(n.code,{children:"example.com/test/api"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Example uploaded Files (local provider):\xa0",(0,r.jsx)(n.code,{children:"example.com/test/uploads"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"JavaScript"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"TypeScript"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"path: ./config/server.ts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export default ({ env }) => ({\r\n  host: env('HOST', '0.0.0.0'),\r\n  port: env.int('PORT', 1337),\r\n  url: 'https://example.com/test',\r\n});\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"nginx-upstream",children:["Nginx Upstream",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#nginx-upstream",title:"Direct link to Nginx Upstream",children:"\u200b"})]}),"\n",(0,r.jsxs)(n.p,{children:["Upstream blocks are used to map an alias such as\xa0",(0,r.jsx)(n.code,{children:"strapi"}),"\xa0to a specific URL such as\xa0",(0,r.jsx)(n.code,{children:"localhost:1337"}),". While it would be useful to define these in each virtual host file, Nginx currently doesn't support loading these within the virtual host if you have multiple virtual host files. Instead, configure these within the\xa0",(0,r.jsx)(n.code,{children:"conf.d"}),"\xa0directory as this is loaded before any virtual host files."]}),"\n",(0,r.jsxs)(n.p,{children:["In the following configuration the\xa0",(0,r.jsx)(n.code,{children:"localhost:1337"}),"\xa0is mapped to the Nginx alias\xa0",(0,r.jsx)(n.code,{children:"strapi"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# path: /etc/nginx/conf.d/upstream.conf\r\n\r\n# Strapi server\r\nupstream strapi {\r\n    server 127.0.0.1:1337;\r\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"nginx-virtual-host",children:["Nginx Virtual Host",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#nginx-virtual-host",title:"Direct link to Nginx Virtual Host",children:"\u200b"})]}),"\n",(0,r.jsx)(n.p,{children:"Virtual host files are what store the configuration for a specific app, service, or proxied service. For usage with Strapi this virtual host file is handling HTTPS connections and proxying them to Strapi running locally on the server. This configuration also redirects all HTTP requests to HTTPs using a 301 redirect."}),"\n",(0,r.jsxs)(n.p,{children:["In the following examples you will need to replace your domain and likewise your paths to SSL certificates will need to be changed based on where you place them or, if you are using Let's Encrypt, where your script places them. Please also note that while the following path shows\xa0",(0,r.jsx)(n.code,{children:"sites-available"}),"\xa0you will need to symlink the file to\xa0",(0,r.jsx)(n.code,{children:"sites-enabled"}),"\xa0in order for Nginx to enable the config."]}),"\n",(0,r.jsx)(n.p,{children:"The following are 2 example Nginx configurations:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["subdomain based such as\xa0",(0,r.jsx)(n.code,{children:"api.example.com"})]}),"\n",(0,r.jsxs)(n.li,{children:["subfolder based with both the API and Admin on the same subfolder such as\xa0",(0,r.jsx)(n.code,{children:"example.com/test/api"}),"\xa0and\xa0",(0,r.jsx)(n.code,{children:"example.com/test/admin"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u270f\ufe0f\xa0Subfolder split is not supported"}),"\n",(0,r.jsxs)(n.p,{children:["Using subfolder split (eg:\xa0",(0,r.jsx)(n.code,{children:"https://example.com/dashboard"}),"\xa0and\xa0",(0,r.jsx)(n.code,{children:"https://example.com/api"}),") are not supported nor recommended with Strapi. It's advised that you either use subdomains (eg:\xa0",(0,r.jsx)(n.code,{children:"https://api.example.com"}),") or subfolder unified (eg:\xa0",(0,r.jsx)(n.code,{children:"https://example.com/strapi/dashboard"}),"\xa0and\xa0",(0,r.jsx)(n.code,{children:"https://example.com/strapi/api"}),")."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Subdomain"}),"\n"]}),"\n",(0,r.jsxs)(n.h4,{id:"subdomain",children:["Subdomain",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#subdomain",title:"Direct link to Subdomain",children:"\u200b"})]}),"\n",(0,r.jsx)(n.p,{children:"This configuration is using the subdomain that is dedicated to Strapi only. It will redirect normal HTTP traffic over to SSL and proxies all requests (both API and admin) to the Strapi server running on the upstream alias configured above."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Example domain:\xa0",(0,r.jsx)(n.code,{children:"api.example.com"})]}),"\n",(0,r.jsxs)(n.li,{children:["Example admin panel:\xa0",(0,r.jsx)(n.code,{children:"api.example.com/admin"})]}),"\n",(0,r.jsxs)(n.li,{children:["Example API:\xa0",(0,r.jsx)(n.code,{children:"api.example.com/api"})]}),"\n",(0,r.jsxs)(n.li,{children:["Example uploaded Files (local provider):\xa0",(0,r.jsx)(n.code,{children:"api.example.com/uploads"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# path: /etc/nginx/sites-available/strapi.conf\r\n\r\nserver {\r\n    # Listen HTTP\r\n    listen 80;\r\n    server_name api.example.com;\r\n    # Redirect HTTP to HTTPS\r\n    return 301 https://$host$request_uri;\r\n}\r\n\r\nserver {\r\n    # Listen HTTPS\r\n    listen 443 ssl;\r\n    server_name api.example.com;\r\n\r\n    # SSL config\r\n    ssl_certificate /path/to/your/certificate/file;\r\n    ssl_certificate_key /path/to/your/certificate/key;\r\n    \r\n\xa0\xa0\xa0\xa0# Proxy Config\r\n    location / {\r\n        proxy_pass http://strapi;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header X-Forwarded-Host $host;\r\n        proxy_set_header X-Forwarded-Server $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_set_header Host $http_host;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection "Upgrade";\r\n        proxy_pass_request_headers on;\r\n    }\r\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"subfolder-unified",children:["Subfolder unified",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#subfolder-unified",title:"Direct link to Subfolder unified",children:"\u200b"})]}),"\n",(0,r.jsxs)(n.p,{children:["This configuration is using a subfolder dedicated to Strapi only. It will redirect normal HTTP traffic over to SSL and hosts the front-end files on\xa0",(0,r.jsx)(n.code,{children:"/var/www/html"}),"\xa0like a normal web server, but proxies all strapi requests on the\xa0",(0,r.jsx)(n.code,{children:"example.com/test"}),"\xa0sub-path."]}),"\n",(0,r.jsx)(n.p,{children:"\u270f\ufe0f\xa0Note"}),"\n",(0,r.jsx)(n.p,{children:"This example configuration is not focused on the front end hosting and should be adjusted to your front-end software requirements."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Example domain:\xa0",(0,r.jsx)(n.code,{children:"example.com/test"})]}),"\n",(0,r.jsxs)(n.li,{children:["Example admin:\xa0",(0,r.jsx)(n.code,{children:"example.com/test/admin"})]}),"\n",(0,r.jsxs)(n.li,{children:["Example API:\xa0",(0,r.jsx)(n.code,{children:"example.com/test/api"})]}),"\n",(0,r.jsxs)(n.li,{children:["Example uploaded files (local provider):\xa0",(0,r.jsx)(n.code,{children:"example.com/test/uploads"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# path: /etc/nginx/sites-available/strapi.conf\r\n\r\nserver {\r\n    # Listen HTTP\r\n    listen 80;\r\n    server_name example.com;\r\n    # Redirect HTTP to HTTPS\r\n    return 301 https://$host$request_uri;\r\n}\r\n\r\nserver {\r\n    # Listen HTTPS\r\n    listen 443 ssl;\r\n    server_name example.com;\r\n\r\n    # SSL config\r\n    ssl_certificate /path/to/your/certificate/file;\r\n    ssl_certificate_key /path/to/your/certificate/key;\r\n\r\n    # Static Root\r\n    location / {\r\n        root /var/www/html;\r\n    }\r\n\r\n\r\n    # Strapi API and Admin\r\n    location /test/ {\r\n        rewrite ^/test/?(.*)$ /$1 break;\r\n        proxy_pass http://strapi;\r\n        proxy_http_version 1.1;\r\n        proxy_set_header X-Forwarded-Host $host;\r\n        proxy_set_header X-Forwarded-Server $host;\r\n        proxy_set_header X-Real-IP $remote_addr;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n        proxy_set_header Host $http_host;\r\n        proxy_set_header Upgrade $http_upgrade;\r\n        proxy_set_header Connection "Upgrade";\r\n        proxy_pass_request_headers on;\r\n    }\r\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"redirecting-landing-page-to-admin-panel",children:["Redirecting landing page to admin panel",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#redirecting-landing-page-to-admin-panel",title:"Direct link to Redirecting landing page to admin panel",children:"\u200b"})]}),"\n",(0,r.jsxs)(n.p,{children:["If you do not wish to have the default landing page mounted on\xa0",(0,r.jsx)(n.code,{children:"/"}),"\xa0you can create a custom middleware using the sample code below to automatically redirect to your admin panel."]}),"\n",(0,r.jsxs)(n.h3,{id:"redirecting-landing-page-to-admin-panel-1",children:["Redirecting landing page to admin panel",(0,r.jsx)(n.a,{href:"https://docs.strapi.io/dev-docs/deployment/nginx-proxy#redirecting-landing-page-to-admin-panel",title:"Direct link to Redirecting landing page to admin panel",children:"\u200b"})]}),"\n",(0,r.jsxs)(n.p,{children:["If you do not wish to have the default landing page mounted on\xa0",(0,r.jsx)(n.code,{children:"/"}),"\xa0you can create a custom middleware using the sample code below to automatically redirect to your admin panel."]}),"\n",(0,r.jsx)(n.p,{children:"\u270b\xa0Caution"}),"\n",(0,r.jsxs)(n.p,{children:["This sample configuration expects that the admin panel is accessible on\xa0",(0,r.jsx)(n.code,{children:"/admin"}),". If you used one of the above configurations to change this to\xa0",(0,r.jsx)(n.code,{children:"/dashboard"}),"\xa0you will also need to adjust this sample configuration."]}),"\n",(0,r.jsx)(n.p,{children:"./config/middlewares.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"module.exports = ({ env }) => [\r\n    // ...    { resolve: './src/middlewares/admin-redirect' },\r\n];\n"})}),"\n",(0,r.jsx)(n.p,{children:"./src/middlewares/admin-redirect.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"module.exports = (_config, { strapi }) => {\r\n    const redirects = ['/', '/index.html'].map((path) => ({\r\n        method: 'GET',\r\n        path,\r\n        handler: (ctx) => ctx.redirect('/admin'),\r\n        config: { auth: false },\r\n    }));\r\n\r\n    strapi.server.routes(redirects);\r\n};\n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var r=i(6540);const t={},s=r.createContext(t);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);